# Diagrama de Arquitectura - IntegraciÃ³n SUNAT

## ğŸ—ï¸ Arquitectura General del Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USUARIO FINAL                               â”‚
â”‚                    (En http://localhost:5173)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (React)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PÃ¡gina: /reportes                                            â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚ Tabla de Ventas                                        â”‚  â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚
â”‚  â”‚ â”‚ ID â”‚ Cliente â”‚ Productos â”‚ MÃ©todo â”‚ Total â”‚ Fecha â”‚  â”‚  â”‚
â”‚  â”‚ â”‚    â”‚         â”‚           â”‚        â”‚       â”‚       â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ âœ… NUEVA COLUMNA: Estado SUNAT                      â”‚  â”‚  â”‚
â”‚  â”‚ â”‚    - Pendiente (â³)                                  â”‚  â”‚  â”‚
â”‚  â”‚ â”‚    - Aceptada (âœ…)                                  â”‚  â”‚  â”‚
â”‚  â”‚ â”‚    - Rechazada (âŒ)                                 â”‚  â”‚  â”‚
â”‚  â”‚ â”‚                                                      â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ âœ… NUEVO BOTÃ“N: SUNAT (icono de factura)           â”‚  â”‚  â”‚
â”‚  â”‚ â”‚    - EnvÃ­a factura a SUNAT                          â”‚  ï¿½ï¿½ï¿½  â”‚
â”‚  â”‚ â”‚    - Abre modal de confirmaciÃ³n                     â”‚  â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    HTTP POST /api/sunat/emit/:id
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND (Node.js + Express)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Ruta: POST /api/sunat/emit/:ventaId                         â”‚  â”‚
â”‚  â”‚ Middleware: auth (JWT)                                       â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚ Controlador: sunatController.ts                        â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ - enviarFacturaSunat()                                 â”‚  â”‚  â”‚
â”‚  â”‚ â”‚   1. Obtener venta de BD                               â”‚  â”‚  â”‚
â”‚  â”‚ â”‚   2. Validar estado                                    â”‚  â”‚  â”‚
â”‚  â”‚ â”‚   3. Construir payload                                 â”‚  â”‚  â”‚
â”‚  â”‚ â”‚   4. Llamar a SunatService                             â”‚  â”‚  â”‚
â”‚  â”‚ â”‚   5. Actualizar BD                                     â”‚  â”‚  â”‚
â”‚  â”‚ â”‚   6. Retornar respuesta                                â”‚  â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚ Servicio: sunatService.ts                              â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ - emitirFactura(facturaData)                           â”‚  â”‚  â”‚
â”‚  â”‚ â”‚   1. Construir headers con token                       â”‚  â”‚  â”‚
â”‚  â”‚ â”‚   2. Hacer POST a API SUNAT                            â”‚  â”‚  â”‚
â”‚  â”‚ â”‚   3. Procesar respuesta                                â”‚  â”‚  â”‚
â”‚  â”‚ â”‚   4. Retornar resultado                                â”‚  â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    HTTP POST /documents/emit
                    Headers: Authorization: Bearer TOKEN
                    Body: { facturaData }
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API SUNAT (Visioner7)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ URL: https://api.visioner7.com/v1                           â”‚  â”‚
â”‚  â”‚ Endpoint: POST /documents/emit                              â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ Procesa:                                                     â”‚  â”‚
â”‚  â”‚ - Valida datos de factura                                   â”‚  â”‚
â”‚  â”‚ - Genera nÃºmero de factura                                  â”‚  â”‚
â”‚  â”‚ - EnvÃ­a a SUNAT                                             â”‚  â”‚
â”‚  â”‚ - Recibe respuesta de SUNAT                                 â”‚  â”‚
â”‚  â”‚ - Retorna resultado                                         â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ Respuesta:                                                   â”‚  â”‚
â”‚  â”‚ {                                                            â”‚  â”‚
â”‚  â”‚   "numeroFactura": "F001-00000001",                         â”‚  â”‚
â”‚  â”‚   "estado": "ACEPTADA",                                     â”‚  â”‚
â”‚  â”‚   "cdr": "...",                                             â”‚  â”‚
â”‚  â”‚   "xml": "...",                                             â”‚  â”‚
â”‚  â”‚   "pdf": "..."                                              â”‚  â”‚
â”‚  â”‚ }                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    HTTP Response
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND (Node.js + Express)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Actualizar BD:                                               â”‚  â”‚
â”‚  â”‚ - estado_sunat = "ACEPTADA"                                 â”‚  â”‚
â”‚  â”‚ - numero_factura = "F001-00000001"                          â”‚  â”‚
â”‚  â”‚ - respuesta_sunat = { respuesta completa }                  â”‚  â”‚
â”‚  â”‚ - fecha_emision_sunat = NOW()                               â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ Retornar respuesta al frontend                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    HTTP Response
                    {
                      "success": true,
                      "estado": "ACEPTADA",
                      "numeroFactura": "F001-00000001"
                    }
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (React)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Actualizar UI:                                               â”‚  â”‚
â”‚  â”‚ - Cerrar modal                                               â”‚  â”‚
â”‚  â”‚ - Mostrar notificaciÃ³n de Ã©xito                              â”‚  â”‚
â”‚  â”‚ - Actualizar estado en tabla                                 â”‚  â”‚
â”‚  â”‚ - Cambiar badge de "Pendiente" a "Aceptada"                 â”‚  â”‚
â”‚  â”‚ - Mostrar nÃºmero de factura                                  â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ Resultado:                                                   â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚ Tabla actualizada con:                                 â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ - Estado: âœ… Aceptada                                  â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ - NÃºmero: F001-00000001                                â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ - BotÃ³n SUNAT deshabilitado (ya enviada)               â”‚  â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Flujo de Datos Detallado

```
PASO 1: Usuario hace clic en botÃ³n SUNAT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend                                â”‚
â”‚ - Abre modal de confirmaciÃ³n            â”‚
â”‚ - Muestra datos de factura              â”‚
â”‚ - Espera confirmaciÃ³n del usuario       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASO 2: Usuario confirma envÃ­o
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend                                â”‚
â”‚ - Hace POST a /api/sunat/emit/:id       â”‚
â”‚ - Incluye token JWT en headers          â”‚
â”‚ - Muestra spinner de carga              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASO 3: Backend recibe solicitud
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend                                 â”‚
â”‚ - Valida token JWT                      â”‚
â”‚ - Obtiene venta de BD                   â”‚
â”‚ - Valida que no estÃ© ya enviada         â”‚
â”‚ - Construye payload de factura          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASO 4: Backend envÃ­a a SUNAT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend                                 â”‚
â”‚ - Llama a SunatService.emitirFactura()  â”‚
â”‚ - Hace POST a API SUNAT                 â”‚
â”‚ - Incluye token de SUNAT en headers     â”‚
â”‚ - Espera respuesta (timeout: 30s)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASO 5: SUNAT procesa factura
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API SUNAT                               â”‚
â”‚ - Valida datos de factura               â”‚
â”‚ - Genera nÃºmero de factura              â”‚
â”‚ - EnvÃ­a a SUNAT                         â”‚
â”‚ - Recibe CDR (Comprobante RecepciÃ³n)    â”‚
â”‚ - Retorna respuesta                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASO 6: Backend actualiza BD
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend                                 â”‚
â”‚ - Recibe respuesta de SUNAT             â”‚
â”‚ - Actualiza estado_sunat en BD          â”‚
â”‚ - Guarda numero_factura                 â”‚
â”‚ - Guarda respuesta_sunat (JSON)         â”‚
â”‚ - Retorna respuesta al frontend         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASO 7: Frontend actualiza UI
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend                                ï¿½ï¿½
â”‚ - Recibe respuesta exitosa              â”‚
â”‚ - Cierra modal                          â”‚
â”‚ - Muestra notificaciÃ³n de Ã©xito         â”‚
â”‚ - Actualiza tabla                       â”‚
â”‚ - Cambia estado a "Aceptada"            â”‚
â”‚ - Muestra nÃºmero de factura             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Estructura de Base de Datos

```
TABLA: ventas
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Campos Existentes                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (INT, PK)                                             â”‚
â”‚ cliente (VARCHAR)                                        â”‚
â”‚ cliente_id (INT, FK)                                     â”‚
â”‚ productos (TEXT)                                         â”‚
â”‚ precio_total (DECIMAL)                                   â”‚
â”‚ metodo_pago (VARCHAR)                                    â”‚
â”‚ fecha_venta (DATETIME)                                   â”‚
â”‚ usuario_id (INT, FK)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… NUEVOS CAMPOS PARA SUNAT                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ estado_sunat (VARCHAR) = 'PENDIENTE'                     â”‚
â”‚   - PENDIENTE: No enviada a SUNAT                        â”‚
â”‚   - ACEPTADA: Aceptada por SUNAT                         â”‚
â”‚   - RECHAZADA: Rechazada por SUNAT                       â”‚
â”‚                                                          â”‚
â”‚ numero_factura (VARCHAR, UNIQUE)                         â”‚
â”‚   - Ejemplo: "F001-00000001"                             â”‚
â”‚   - Generado por SUNAT                                   â”‚
â”‚                                                          â”‚
â”‚ respuesta_sunat (JSON)                                   â”‚
â”‚   - Respuesta completa de SUNAT                          â”‚
â”‚   - Incluye CDR, XML, PDF, etc.                          â”‚
â”‚                                                          â”‚
â”‚ fecha_emision_sunat (DATETIME)                           â”‚
â”‚   - Fecha cuando se enviÃ³ a SUNAT                        â”‚
â”‚                                                          â”‚
â”‚ tipo_comprobante (VARCHAR)                               â”‚
â”‚   - FACTURA o BOLETA                                     â”‚
â”‚                                                          â”‚
â”‚ ÃNDICES:                                                 â”‚
â”‚ - idx_estado_sunat (estado_sunat)                        â”‚
â”‚ - idx_numero_factura (numero_factura, UNIQUE)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Flujo de AutenticaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USUARIO FRONTEND                                        â”‚
â”‚ - Hace login                                            â”‚
â”‚ - Recibe JWT token                                      â”‚
â”‚ - Guarda en localStorage                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SOLICITUD A /api/sunat/emit/:id                         â”‚
â”‚ Headers:                                                â”‚
â”‚ - Authorization: Bearer <JWT_TOKEN>                     â”‚
â”‚ - Content-Type: application/json                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MIDDLEWARE: auth                                        â”‚
â”‚ - Extrae token del header                               â”‚
â”‚ - Verifica firma del token                              â”‚
â”‚ - Valida que no estÃ© expirado                           â”‚
â”‚ - Obtiene datos del usuario                             â”‚
â”‚ - ContinÃºa si es vÃ¡lido                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONTROLADOR: enviarFacturaSunat                         â”‚
â”‚ - Accede a req.user (del middleware)                    â”‚
â”‚ - Procesa solicitud                                     â”‚
â”‚ - Retorna respuesta                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AUTENTICACIÃ“N CON SUNAT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SOLICITUD A API SUNAT                                   â”‚
â”‚ Headers:                                                â”‚
â”‚ - Authorization: Bearer <SUNAT_API_TOKEN>               â”‚
â”‚ - Content-Type: application/json                        â”‚
â”‚                                                         â”‚
â”‚ El token de SUNAT se obtiene de:                        â”‚
â”‚ - Variable de entorno: SUNAT_API_TOKEN                  â”‚
â”‚ - Guardado en .env (no en cÃ³digo)                       â”‚
â”‚ - Nunca se expone al frontend                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Estructura de Archivos

```
bazar-abem-react/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ reportesController.ts (existente)
â”‚   â”‚   â”‚   â”œâ”€â”€ ventasController.ts (existente)
â”‚   â”‚   â”‚   â””â”€â”€ âœ… sunatController.ts (NUEVO)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ emailService.ts (existente)
â”‚   â”‚   â”‚   â”œâ”€â”€ pdfService.ts (existente)
â”‚   â”‚   â”‚   â””â”€â”€ âœ… sunatService.ts (NUEVO)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ reportes.ts (existente)
â”‚   â”‚   â”‚   â”œâ”€â”€ ventas.ts (existente)
â”‚   â”‚   â”‚   â””â”€â”€ âœ… sunat.ts (NUEVO)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts (existente, se usa)
â”‚   â”‚   â”‚   â””â”€â”€ errorHandler.ts (existente, se usa)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â””â”€â”€ database.ts (existente, se usa)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ server.ts (MODIFICAR - agregar ruta SUNAT)
â”‚   â”‚
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”œâ”€â”€ schema.prisma (MODIFICAR - agregar campos)
â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”‚       â””â”€â”€ âœ… [timestamp]_add_sunat_fields/ (NUEVA)
â”‚   â”‚
â”‚   â”œâ”€â”€ .env (MODIFICAR - agregar variables SUNAT)
â”‚   â””â”€â”€ package.json (MODIFICAR - agregar axios)
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â””â”€â”€ Reports.tsx (MODIFICAR - agregar columna y botÃ³n)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ âœ… SunatStatusBadge.tsx (NUEVO)
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ modals/
â”‚   â”‚   â”‚       â”œâ”€â”€ EmailModal.tsx (existente)
â”‚   â”‚   â”‚       â”œâ”€â”€ BolletaPrintModal.tsx (existente)
â”‚   â”‚   â”‚       â””â”€â”€ âœ… SunatModal.tsx (NUEVO)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â””â”€â”€ reportesService.ts (existente, se usa)
â”‚   â”‚
â”‚   â””â”€â”€ package.json (axios ya deberÃ­a estar)
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ âœ… ANALISIS-INTEGRACION-SUNAT-API.md
    â”œâ”€â”€ âœ… GUIA-IMPLEMENTACION-SUNAT.md
    â”œâ”€â”€ âœ… CODIGO-LISTO-SUNAT.md
    â”œâ”€â”€ âœ… RESUMEN-EJECUTIVO-SUNAT.md
    â”œâ”€â”€ âœ… VERIFICACION-COMPATIBILIDAD.md
    â””â”€â”€ âœ… DIAGRAMA-ARQUITECTURA-SUNAT.md (este archivo)
```

---

## ğŸ”„ Ciclo de Vida de una Factura

```
ESTADO 1: PENDIENTE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - Venta registrada en BD                â”‚
â”‚ - estado_sunat = 'PENDIENTE'            â”‚
â”‚ - numero_factura = NULL                 â”‚
â”‚ - BotÃ³n SUNAT habilitado                â”‚
â”‚ - Usuario puede enviar a SUNAT          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Usuario hace clic en botÃ³n SUNAT
                  â”‚
                  â–¼
ESTADO 2: ENVIANDO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - Solicitud en progreso                 â”‚
â”‚ - Spinner de carga visible              â”‚
â”‚ - BotÃ³n SUNAT deshabilitado             â”‚
â”‚ - Esperando respuesta de SUNAT          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Respuesta de SUNAT
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚
        â–¼                   â–¼
ESTADO 3A: ACEPTADA    ESTADO 3B: RECHAZADA
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - Factura OK     â”‚  â”‚ - Error en datos â”‚
â”‚ - NÃºmero asignadoâ”‚  â”‚ - Rechazada      â”‚
â”‚ - CDR recibido   â”‚  â”‚ - Motivo guardadoâ”‚
â”‚ - BotÃ³n disabled â”‚  â”‚ - BotÃ³n habilitado
â”‚ - Badge verde    â”‚  â”‚ - Badge rojo     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚
        â”‚                   â”‚ Usuario puede reintentar
        â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
        ESTADO FINAL
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ - Factura en BD  â”‚
        â”‚ - Historial      â”‚
        â”‚ - AuditorÃ­a      â”‚
        â””â”€â”€â”€â”€â”€ï¿½ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Puntos de IntegraciÃ³n

```
1. FRONTEND â†’ BACKEND
   - Endpoint: POST /api/sunat/emit/:ventaId
   - MÃ©todo: HTTP POST
   - Headers: Authorization: Bearer JWT
   - Body: {} (vacÃ­o, datos obtenidos del ID)
   - Respuesta: { success, estado, numeroFactura, respuesta }

2. BACKEND â†’ BD
   - OperaciÃ³n: SELECT venta WHERE id = :ventaId
   - OperaciÃ³n: UPDATE venta SET estado_sunat, numero_factura, etc.
   - ORM: Prisma

3. BACKEND â†’ API SUNAT
   - Endpoint: POST https://api.visioner7.com/v1/documents/emit
   - MÃ©todo: HTTP POST
   - Headers: Authorization: Bearer SUNAT_TOKEN
   - Body: { facturaData }
   - Respuesta: { numeroFactura, estado, cdr, xml, pdf }

4. FRONTEND â†’ BD (indirecto)
   - A travÃ©s del backend
   - React Query para cachÃ©
   - Refetch despuÃ©s de actualizaciÃ³n
```

---

## âš¡ Optimizaciones

```
1. CACHING
   - React Query cachea datos de reportes
   - Invalidar cache despuÃ©s de enviar a SUNAT
   - Refetch automÃ¡tico

2. RATE LIMITING
   - MÃ¡ximo 10 requests por minuto a SUNAT
   - Previene abuso
   - Protege API

3. ÃNDICES DE BD
   - idx_estado_sunat para filtros rÃ¡pidos
   - idx_numero_factura para bÃºsquedas
   - Mejora performance

4. ASYNC/AWAIT
   - No bloquea UI
   - Mejor experiencia de usuario
   - Manejo de errores robusto
```

---

**Diagrama generado:** 2025
**VersiÃ³n:** 1.0
**Compatibilidad:** 100% âœ…
